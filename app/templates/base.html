{% load static %}
{% load tz %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}SkillsSpire - –û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã{% endblock %}</title>

  <!-- Meta —Ç–µ–≥–∏ -->
  <meta property="og:title" content="{% block og_title %}SkillsSpire - –û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã{% endblock %}">
  <meta property="og:description" content="{% block og_description %}–û—Å–≤–æ–π—Ç–µ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —Å –ª—É—á—à–∏–º–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.{% endblock %}">
  <meta property="og:image" content="{% block og_image %}{% static 'img/og-default.jpg' %}{% endblock %}">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:type" content="website">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/favicon/apple-touch-icon.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon/favicon-16x16.png' %}">
  <link rel="manifest" href="{% static 'img/favicon/site.webmanifest' %}">

  <!-- Preload –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" as="style">
  <link rel="preload" href="{% static 'css/main.css' %}" as="style">
  <link rel="preload" href="{% static 'js/main.js' %}" as="script">
  
  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"></noscript>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{% static 'css/main.css' %}?v={{ STATIC_VERSION|default:'1.0' }}">
  
  <!-- AI Widget CSS (–æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞) -->
  <link rel="preload" href="{% static 'ai-widget/ai-widget.css' %}" as="style">
  <link rel="stylesheet" href="{% static 'ai-widget/ai-widget.css' %}" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="{% static 'ai-widget/ai-widget.css' %}"></noscript>
  
  <!-- Inline –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS (—Ç–æ–ª—å–∫–æ —Å–∞–º–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ) -->
  <style>
    /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–¥–≤–∏–≥–æ–≤ –º–∞–∫–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
    .nav-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--color-text, #000);
      text-decoration: none;
    }
    .nav-brand img {
      display: block;
      height: 40px;
      width: auto;
    }
    .nav-brand span {
      white-space: nowrap;
    }
    /* –°–∫—Ä—ã–≤–∞–µ–º AI –ø–∞–Ω–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    #ai-panel { display: none; }
  </style>
  
  {% block extra_css %}{% endblock %}
</head>
<body>

{% include "components/mascot_snowleopard.html" %}

<nav class="main-nav">
  <div class="container nav-container">
    <a class="nav-brand" href="{% url 'home' %}">
      <img src="{% static 'img/logo_skillsspire_light.png' %}" alt="SkillsSpire" width="40" height="40" loading="eager">
    </a>
    <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
      <span></span><span></span><span></span>
    </button>

    <div class="nav-menu" id="navMenu">
      <div class="nav-menu-inner">
        <ul class="nav-list">
          <li><a class="nav-link" href="{% url 'home' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
          <li><a class="nav-link" href="{% url 'courses_list' %}">–í—Å–µ –∫—É—Ä—Å—ã</a></li>
          <li><a class="nav-link" href="{% url 'articles_list' %}">–°—Ç–∞—Ç—å–∏</a></li>
          <li><a class="nav-link" href="{% url 'materials_list' %}">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a></li>
          <li><a class="nav-link" href="{% url 'about' %}">–û –Ω–∞—Å</a></li>
          <li><a class="nav-link" href="{% url 'contact' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
          {% if user.is_authenticated and user.is_instructor %}
          <li class="nav-highlight"><a class="nav-link" href="{% url 'course_create' %}"><i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a></li>
          {% endif %}
        </ul>

        <div class="nav-actions">
          <form class="nav-search" action="{% url 'courses_list' %}" method="get">
            <input type="search" name="q" placeholder="–ü–æ–∏—Å–∫ –∫—É—Ä—Å–æ–≤...">
            <button type="submit" aria-label="Search"><i class="bi bi-search"></i></button>
          </form>

          {% if user.is_authenticated %}
          <div class="nav-notifications">
            <button class="nav-icon-btn is-disabled"
                    type="button"
                    title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è"
                    aria-disabled="true"
                    disabled>
              <i class="bi bi-bell"></i>
            </button>
          </div>

          <div class="nav-user dropdown">
            <button class="nav-user-btn" aria-haspopup="true" aria-expanded="false">
              {% if user.is_instructor and user.instructor_profile.avatar %}
                <img src="{{ user.instructor_profile.avatar.url }}" 
                     alt="{{ user.get_full_name }}" 
                     width="32" height="32" 
                     loading="lazy"
                     style="border-radius:50%;object-fit:cover;">
              {% else %}
                <div class="nav-user-avatar">{{ user.first_name|first|default:user.email|first|upper }}</div>
              {% endif %}
              <span>{{ user.first_name|default:user.email }}</span>
              <i class="bi bi-chevron-down"></i>
            </button>
            <div class="dropdown-menu">
              <h6>–ú–æ–π –∞–∫–∫–∞—É–Ω—Ç</h6>
              <a href="{% url 'dashboard' %}"><i class="bi bi-speedometer2"></i> –î–∞—à–±–æ—Ä–¥</a>
              <a href="{% url 'my_courses' %}"><i class="bi bi-book"></i> –ú–æ–∏ –∫—É—Ä—Å—ã</a>
              <div class="dropdown-divider"></div>
              <a href="#"><i class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
              <form action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <button type="submit"><i class="bi bi-box-arrow-right"></i> –í—ã–π—Ç–∏</button>
              </form>
            </div>
          </div>
          {% else %}
          <div class="nav-auth">
            <a href="{% url 'signup' %}" class="btn btn-outline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            <a href="{% url 'login' %}" class="btn btn-primary">–í–æ–π—Ç–∏</a>
          </div>
          {% endif %}

          <div class="nav-utils">
            <form action="{% url 'set_language' %}" method="post">{% csrf_token %}
              {% get_current_language as LANGUAGE_CODE %}
              <input type="hidden" name="next" value="{{ request.path }}">
              <select name="language" onchange="this.form.submit()" aria-label="Language">
                <option value="ru" {% if LANGUAGE_CODE == 'ru' %}selected{% endif %}>RU</option>
                <option value="en" {% if LANGUAGE_CODE == 'en' %}selected{% endif %}>EN</option>
                <option value="kz" {% if LANGUAGE_CODE == 'kz' %}selected{% endif %}>KZ</option>
              </select>
            </form>
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">üåô</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

{% if messages %}
<div class="messages-container">
  <div class="container">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" data-autohide="true">
      <div class="alert-content">
        {% if message.tags == 'success' %}<i class="bi bi-check-circle-fill"></i>
        {% elif message.tags == 'error' %}<i class="bi bi-exclamation-circle-fill"></i>
        {% elif message.tags == 'warning' %}<i class="bi bi-exclamation-triangle-fill"></i>
        {% else %}<i class="bi bi-info-circle-fill"></i>{% endif %}
        <span>{{ message }}</span>
      </div>
      <button class="alert-close" aria-label="Close">&times;</button>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<main>
  {% block content %}{% endblock %}
</main>

<footer class="main-footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-col">
        <a class="footer-brand" href="{% url 'home' %}">
          <img src="{% static 'img/logo_skillsspire_light.png' %}" alt="SkillsSpire" width="40" height="40" loading="lazy">
        </a>
        <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–æ–±—É—á–µ–Ω–∏—è —Å –ª—É—á—à–∏–º–∏ –∫—É—Ä—Å–∞–º–∏ –æ—Ç —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ —Ä—ã–Ω–∫–∞.</p>
        <div class="footer-social">
          <a href="#"><i class="bi bi-telegram"></i></a>
          <a href="#"><i class="bi bi-whatsapp"></i></a>
          <a href="#"><i class="bi bi-youtube"></i></a>
          <a href="#"><i class="bi bi-instagram"></i></a>
        </div>
      </div>

      <div class="footer-col">
        <h5>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h5>
        <ul>
          <li><a href="{% url 'home' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
          <li><a href="{% url 'courses_list' %}">–í—Å–µ –∫—É—Ä—Å—ã</a></li>
          <li><a href="{% url 'articles_list' %}">–°—Ç–∞—Ç—å–∏</a></li>
          <li><a href="{% url 'materials_list' %}">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a></li>
          <li><a href="{% url 'about' %}">–û –Ω–∞—Å</a></li>
          <li><a href="{% url 'contact' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h5>
        <ul>
          <li><a href="#">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</a></li>
          <li><a href="#">–î–∏–∑–∞–π–Ω</a></li>
          <li><a href="#">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</a></li>
          <li><a href="#">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É</h5>
        <p>–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –æ –∫—É—Ä—Å–∞—Ö.</p>
        <form class="footer-subscribe">
          <input type="email" placeholder="–í–∞—à email">
          <button type="submit">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
        </form>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-info">
        <p>–¢–û–û ¬´SkillsSpire¬ª ‚Äî 240440040785, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –≥. –ê—Å—Ç–∞–Ω–∞</p>
        <p>E-mail: <a href="mailto:support@skillsspire.com">support@skillsspire.com</a> | –¢–µ–ª: <a href="tel:+77012925568">+7 (701) 292-55-68</a></p>
      </div>
      <p>&copy; 2025 SkillsSpire. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      <div class="footer-payments">
        <img src="{% static 'img/payments/visa.png' %}" alt="Visa" width="40" height="25" loading="lazy">
        <img src="{% static 'img/payments/mastercard.png' %}" alt="MasterCard" width="40" height="25" loading="lazy">
      </div>
    </div>
  </div>
</footer>

<!-- AI Widget HTML -->
<div id="ai-bubble" class="ai-floating" title="–ò–ò –ø–æ–º–æ—â–Ω–∏–∫ SkillsSpire" aria-label="–û—Ç–∫—Ä—ã—Ç—å –ò–ò –ø–æ–º–æ—â–Ω–∏–∫"></div>
<div id="ai-panel" aria-hidden="true">
  <div id="ai-header">
    <span>ü§ñ –ò–ò –ø–æ–º–æ—â–Ω–∏–∫ SkillsSpire</span>
    <button id="ai-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å">‚úï</button>
  </div>
  <div id="ai-messages">
    <div class="ai-msg ai-bot">
      –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∫—É—Ä—Å–∞–º SkillsSpire. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? üéì
    </div>
  </div>
  <div id="ai-status" aria-live="polite"></div>
  <div id="ai-inputbar">
    <textarea id="ai-text" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –∫—É—Ä—Å–∞—Ö..." rows="1" aria-label="–í–æ–ø—Ä–æ—Å –¥–ª—è –ò–ò –ø–æ–º–æ—â–Ω–∏–∫–∞"></textarea>
    <button id="ai-send" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">‚û§</button>
  </div>
</div>

<!-- Preload –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@srexi/purecounterjs/dist/purecounter_vanilla.js" as="script">
<link rel="preload" href="{% static 'ai-widget/ai-widget.js' %}" as="script">

<!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å defer -->
<script defer src="https://cdn.jsdelivr.net/npm/@srexi/purecounterjs/dist/purecounter_vanilla.js"></script>
<script defer src="{% static 'js/main.js' %}?v={{ STATIC_VERSION|default:'1.0' }}"></script>
<script defer src="{% static 'ai-widget/ai-widget.js' %}?v={{ STATIC_VERSION|default:'1.0' }}"></script>

<!-- Inline JS –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ -->
<script>
// –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π JS –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ main.js
(function() {
  'use strict';
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('alert-close')) {
      e.target.closest('.alert').style.display = 'none';
    }
  });
  
  // –ë–∞–∑–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
  var navToggle = document.getElementById('navToggle');
  var navMenu = document.getElementById('navMenu');
  
  if (navToggle && navMenu) {
    navToggle.addEventListener('click', function() {
      navMenu.classList.toggle('open');
      navToggle.setAttribute('aria-expanded', navMenu.classList.contains('open'));
    });
  }
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
  var themeToggle = document.getElementById('themeToggle');
  if (themeToggle) {
    themeToggle.addEventListener('click', function() {
      var html = document.documentElement;
      var current = html.getAttribute('data-theme') || 'light';
      var next = current === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      themeToggle.textContent = next === 'dark' ? 'üåû' : 'üåô';
      themeToggle.setAttribute('aria-label', next === 'dark' ? 'Switch to light theme' : 'Switch to dark theme');
    });
  }
})();
</script>

{% block extra_js %}{% endblock %}
</body>
</html>