{% load static %}
{% load i18n %}
{% extends "base.html" %}

{% block content %}

<!-- üîπ Hero -->
<section class="course-hero">
  <div class="container text-center">
    <span class="course-badge">{{ course.category.name }}</span>
    <h1 class="course-title">{{ course.title }}</h1>
    <p class="course-subtitle">{{ course.short_description }}</p>

    <ul style="list-style:none; padding:0; margin:1rem 0; line-height:1.7;">
      <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</li>
      <li>üì± –û–Ω–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø 24/7</li>
    </ul>

    <div class="mt-3">
      {% if has_access %}
        <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="hero-btn hero-btn-primary">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
      {% else %}
        {% if user.is_authenticated %}
          <a href="{% url 'course_payment' course.slug %}" class="hero-btn hero-btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å</a>
        {% else %}
          <a href="{% url 'register' %}?next={% url 'course_payment' course.slug %}" class="hero-btn hero-btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å</a>
        {% endif %}
      {% endif %}
      <a href="#program" class="hero-btn hero-btn-secondary">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</a>
    </div>

    <hr style="margin:2rem auto; opacity:0.2; max-width:480px;">

    <div style="margin-top:1rem;">
      <h2 style="font-size:1.6rem; font-weight:700;">{{ course.price }} ‚Ç∏</h2>
      <div class="mt-2" style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap;">
        <a href="{% if user.is_authenticated %}{% url 'course_payment' course.slug %}{% else %}{% url 'register' %}?next={% url 'course_payment' course.slug %}{% endif %}" class="btn btn-primary">üõí –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
        <button class="btn btn-outline">‚ô° –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
      </div>
    </div>

    <div class="mt-4" style="color:#fff; opacity:.9;">
      <p>–í –∫—É—Ä—Å –≤—Ö–æ–¥–∏—Ç:</p>
      <ul style="list-style:none; padding:0; margin:0; line-height:1.8;">
        <li>üìò {{ lessons|length }} —É—Ä–æ–∫–æ–≤</li>
        <li>üíæ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è</li>
        <li>‚ôæÔ∏è –ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø</li>
        <li>üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</li>
        <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</li>
      </ul>
    </div>
  </div>
</section>

<!-- üîπ –û –∫—É—Ä—Å–µ -->
<section class="section">
  <div class="container">
    <div class="certificates-grid">
      <div class="certificate-info">
        <h2>–û –∫—É—Ä—Å–µ</h2>
        {% if course.description %}
          <p>{{ course.description }}</p>
        {% else %}
          <p>–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è.</p>
        {% endif %}
      </div>
      <div class="certificate-image">
        <img src="{{ course.image.url|default:static('img/default.jpg') }}" alt="{{ course.title }}">
      </div>
    </div>
  </div>
</section>

<!-- üîπ –ü—Ä–æ–≥—Ä–∞–º–º–∞ -->
<section id="program" class="section" style="background: var(--color-bg-section);">
  <div class="container">
    <h2 class="text-center mb-3">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</h2>
    {% if lessons %}
      <div class="courses-grid">
        {% for lesson in lessons %}
          <div class="course-card card-hover">
            <div class="course-card-content">
              <h3 class="course-card-title">{{ lesson.title }}</h3>
              <p class="course-card-text">{{ lesson.description|truncatewords:20 }}</p>
              {% if has_access %}
                <a href="{% url 'lesson_detail' course.slug lesson.slug %}" class="btn btn-primary btn-full mt-2">–°–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–∫</a>
              {% else %}
                <button class="btn btn-outline btn-full mt-2" disabled>üîí –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center mt-3">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ.</p>
    {% endif %}
  </div>
</section>

<!-- üîπ –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä -->
<section class="section">
  <div class="container text-center">
    <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</h2>
    {% if teacher_profile %}
      <div style="display:inline-flex;align-items:center;gap:1rem;margin-top:1.5rem;">
        <img src="{{ teacher_profile.display_avatar_url|default:static('img/default.jpg') }}" alt="{{ teacher_profile.user.get_full_name }}" width="90" height="90" style="border-radius:50%;">
        <div style="text-align:left;">
          <h3>{{ teacher_profile.user.get_full_name }}</h3>
          <p class="text-secondary">{{ teacher_profile.title|default:"–≠–∫—Å–ø–µ—Ä—Ç" }}</p>
        </div>
      </div>
    {% else %}
      <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ.</p>
    {% endif %}
  </div>
</section>

<!-- üîπ –û—Ç–∑—ã–≤—ã -->
<section class="testimonials-section">
  <div class="container">
    <h2 class="text-center mb-3">–û—Ç–∑—ã–≤—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
    {% if reviews %}
      <div class="testimonials-grid">
        {% for review in reviews %}
        <div class="testimonial-card">
          <p>‚Äú{{ review.text|truncatewords:40 }}‚Äù</p>
          <p class="text-sm text-secondary">‚Äî {{ review.user.get_full_name|default:"–ê–Ω–æ–Ω–∏–º" }}, {{ review.created_at|date:"d M Y" }}</p>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
  </div>
</section>

{% endblock %}
