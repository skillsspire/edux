{% load static %}
{% load i18n %}
{% extends "base.html" %}

{% block content %}

<!-- Hero-—Å–µ–∫—Ü–∏—è –∫—É—Ä—Å–∞ -->
<section class="course-hero">
  <div class="container text-center">
    <span class="course-badge">{{ course.category.name }}</span>
    <h1 class="course-title">{{ course.title }}</h1>
    <p class="course-subtitle">{{ course.short_description }}</p>

    <div class="mt-3">
      <a href="#program" class="hero-btn hero-btn-primary">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</a>
      {% if has_access %}
        <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="hero-btn hero-btn-secondary">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
      {% else %}
        <a href="{% url 'enroll_course' course.slug %}" class="hero-btn hero-btn-secondary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
      {% endif %}
    </div>
  </div>
</section>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<section class="section">
  <div class="container">
    <div class="course-details-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
      <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞ -->
      <div>
        <h2>–û –∫—É—Ä—Å–µ</h2>
        <p>{{ course.description|default:"–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è." }}</p>

        <div class="mt-4">
          <h3 id="program">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</h3>
          {% if lessons %}
            <ul>
              {% for lesson in lessons %}
                <li>
                  {% if has_access %}
                    <a href="{% url 'lesson_detail' course.slug lesson.slug %}">{{ lesson.title }}</a>
                  {% else %}
                    <span>{{ lesson.title }}</span> üîí
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p>–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ.</p>
          {% endif %}
        </div>

        <div class="mt-4">
          <h3>–û—Ç–∑—ã–≤—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h3>
          {% if reviews %}
            <div class="testimonials-grid">
              {% for review in reviews %}
              <div class="testimonial-card">
                <p>‚Äú{{ review.text|truncatewords:40 }}‚Äù</p>
                <p class="text-sm text-secondary">‚Äî {{ review.user.get_full_name|default:"–ê–Ω–æ–Ω–∏–º" }}, {{ review.created_at|date:"d M Y" }}</p>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –æ –∫—É—Ä—Å–µ.</p>
          {% endif %}
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
      <aside>
        <div class="course-card">
          <img src="{{ course.image.url|default:static('img/default.jpg') }}" alt="{{ course.title }}" class="course-card-img">
          <div class="course-card-content">
            <h3 class="course-card-title">–°—Ç–æ–∏–º–æ—Å—Ç—å</h3>
            {% if course.discount_price %}
              <p><s>{{ course.price }} ‚Ç∏</s> <strong>{{ course.discount_price }} ‚Ç∏</strong></p>
            {% else %}
              <p><strong>{{ course.price }} ‚Ç∏</strong></p>
            {% endif %}

            <div class="mt-2">
              {% if has_access %}
                <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="btn btn-primary btn-full">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
              {% else %}
                <a href="{% url 'enroll_course' course.slug %}" class="btn btn-primary btn-full">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
              {% endif %}
            </div>

            <hr>

            <ul>
              <li>üìò {{ lessons|length }} —É—Ä–æ–∫–æ–≤</li>
              <li>üïí {{ course.duration_hours }} —á–∞—Å–æ–≤</li>
              <li>‚ôæÔ∏è –î–æ—Å—Ç—É–ø 24/7</li>
              <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</li>
            </ul>
          </div>
        </div>

        <div class="mt-4">
          <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</h3>
          {% if teacher_profile %}
            <div style="display: flex; align-items: center; gap: 1rem;">
              {% if teacher_profile.display_avatar_url %}
                <img src="{{ teacher_profile.display_avatar_url }}" alt="–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä" width="70" height="70" style="border-radius: 50%;">
              {% else %}
                <img src="{% static 'img/default.jpg' %}" alt="–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä" width="70" height="70" style="border-radius: 50%;">
              {% endif %}
              <div>
                <strong>{{ teacher_profile.user.get_full_name }}</strong><br>
                <span>{{ teacher_profile.title|default:"–≠–∫—Å–ø–µ—Ä—Ç" }}</span>
              </div>
            </div>
          {% else %}
            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ.</p>
          {% endif %}
        </div>
      </aside>
    </div>
  </div>
</section>

{% endblock %}
