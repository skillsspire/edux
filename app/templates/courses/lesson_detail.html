{% extends "base.html" %}
{% load static humanize %}

{% block title %}{{ course.title }} ‚Äî SkillsSpire{% endblock %}

{% block content %}

<section class="course-hero modern-hero">
    <div class="container hero-inner">

        <div class="hero-left">
            <span class="course-badge">{{ course.category.name }}</span>
            <h1>{{ course.title }}</h1>
            <p>{{ course.short_description }}</p>

            <ul class="hero-features">
                <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</li>
                <li>üì± –û–Ω–ª–∞–π–Ω –¥–æ—Å—Ç—É–ø 24/7</li>
                {% if course.duration_hours %}<li>‚è∞ {{ course.duration_hours }} —á–∞—Å–æ–≤</li>{% endif %}
            </ul>

            <div class="hero-actions">

                {% if has_access %}
                    <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="btn btn-primary">
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—É—á–µ–Ω–∏—é
                    </a>

                {% else %}

                    {% if course.price == 0 %}
                        <form action="{% url 'enroll_course' course.slug %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
                        </form>

                    {% else %}
                        <a href="{% url 'create_payment' course.slug %}" class="btn btn-primary">
                            –û–ø–ª–∞—Ç–∏—Ç—å –∏ –Ω–∞—á–∞—Ç—å
                        </a>
                    {% endif %}

                {% endif %}

                <a href="#program" class="btn btn-outline">–ü—Ä–æ–≥—Ä–∞–º–º–∞</a>
            </div>
        </div>

        <div class="hero-right">
            <div class="course-price-card">

                {% if course.discount_price %}
                    <p class="old-price">{{ course.price|floatformat:0|intcomma }} ‚Ç∏</p>
                    <p class="new-price">{{ course.discount_price|floatformat:0|intcomma }} ‚Ç∏</p>
                {% else %}
                    <p class="new-price">
                        {% if course.price == 0 %}–ë–µ—Å–ø–ª–∞—Ç–Ω–æ{% else %}{{ course.price|floatformat:0|intcomma }} ‚Ç∏{% endif %}
                    </p>
                {% endif %}

                {% if has_access %}
                    <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="btn btn-primary btn-full">
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—É—á–µ–Ω–∏—é
                    </a>
                {% else %}
                    {% if course.price == 0 %}
                        <form action="{% url 'enroll_course' course.slug %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary btn-full">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
                        </form>
                    {% else %}
                        <a href="{% url 'create_payment' course.slug %}" class="btn btn-primary btn-full">
                            –û–ø–ª–∞—Ç–∏—Ç—å –∫—É—Ä—Å
                        </a>
                    {% endif %}
                {% endif %}

                <form action="{% url 'toggle_wishlist' course.slug %}" method="post" class="mt-2">
                    {% csrf_token %}
                    <button class="btn btn-outline btn-full">
                        ‚ô° –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                    </button>
                </form>

            </div>
        </div>

    </div>
</section>


<section class="section course-about">
    <div class="container about-grid">
        <div class="about-text">
            <h2>–û –∫—É—Ä—Å–µ</h2>
            <p>{{ course.description|safe|default:"–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è." }}</p>

            <ul>
                <li>üìò {{ lessons|length }} —É—Ä–æ–∫–æ–≤</li>
                <li>‚ôæÔ∏è –ü–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø</li>
                <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏</li>
            </ul>
        </div>

        <div class="about-img">
            <img src="{{ course.display_image_url }}" alt="{{ course.title }}">
        </div>
    </div>
</section>


<section id="program" class="section program-section">
    <div class="container">
        <h2 class="text-center mb-3">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</h2>

        {% if lessons %}
            <div class="lessons-list">

                {% for lesson in lessons %}
                <div class="lesson-item">
                    <div class="lesson-info">
                        <h3>{{ lesson.title }}</h3>
                        {% if lesson.duration_minutes %}
                        <p>{{ lesson.duration_minutes }} –º–∏–Ω</p>
                        {% endif %}
                    </div>

                    {% if has_access %}
                        <a href="{% url 'lesson_detail' course.slug lesson.slug %}" class="btn btn-outline">
                            ‚ñ∂ –°–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                    {% else %}
                        <button class="btn btn-outline" disabled>üîí –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
                    {% endif %}
                </div>
                {% endfor %}

            </div>

        {% else %}
            <p class="text-center text-muted">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ.</p>
        {% endif %}
    </div>
</section>


<section class="section instructor-section">
    <div class="container text-center">
        <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</h2>

        <div class="instructor-card">
            <img src="{{ teacher_profile.display_avatar_url }}" alt="{{ teacher.get_full_name }}">
            <h3>{{ teacher.get_full_name }}</h3>
            <p class="text-secondary">{{ teacher_profile.specialization|default:"–≠–∫—Å–ø–µ—Ä—Ç" }}</p>
            <p>{{ teacher_profile.bio|truncatewords:30 }}</p>
        </div>

    </div>
</section>


<section class="testimonials-section">
    <div class="container">
        <h2 class="text-center mb-3">–û—Ç–∑—ã–≤—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>

        {% if reviews %}
        <div class="testimonials-grid">
            {% for r in reviews %}
            <div class="testimonial-card">
                <p>‚Äú{{ r.comment|truncatewords:35 }}‚Äù</p>
                <p class="text-sm text-secondary">‚Äî {{ r.name|default:"–ê–Ω–æ–Ω–∏–º" }}, {{ r.created_at|date:"d M Y" }}</p>
            </div>
            {% endfor %}
        </div>

        {% else %}
            <p class="text-center text-muted">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
        {% endif %}
    </div>
</section>

{% endblock %}
