{% extends 'base.html' %}
{% load static %}

{% block title %}–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–æ–≤ ‚Äî SkillsSpire{% endblock %}

{% block content %}

<section class="section py-5">
  <div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="section-header text-center mb-4">
      <h1 class="mb-2">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–æ–≤</h1>
      <p class="text-muted">–£—á–∏—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é –ø–ª–∞—Ç—É</p>
    </div>

    <!-- SEO-–±–ª–æ–∫ -->
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <p class="text-muted">
          –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ SkillsSpire –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã –ø–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º, –∞–Ω–∞–ª–∏—Ç–∏–∫–µ, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É –∏ —ç–∫–æ–Ω–æ–º–∏–∫–µ. 
          –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Ä–µ–∑—é–º–µ –∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∑–∞ —Ä—É–±–µ–∂.
        </p>
      </div>
    </div>

    <!-- üîπ –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters row g-3 justify-content-center mb-4">
      <div class="col-auto">
        <select class="form-select filter-select" data-param="level">
          <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
          <option value="beginner" {% if request.GET.level == 'beginner' %}selected{% endif %}>–ù–∞—á–∏–Ω–∞—é—â–∏–π</option>
          <option value="intermediate" {% if request.GET.level == 'intermediate' %}selected{% endif %}>–°—Ä–µ–¥–Ω–∏–π</option>
          <option value="advanced" {% if request.GET.level == 'advanced' %}selected{% endif %}>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
        </select>
      </div>

      <div class="col-auto">
        <select class="form-select filter-select" data-param="certificate">
          <option value="">–í—Å–µ –∫—É—Ä—Å—ã</option>
          <option value="available" {% if request.GET.certificate == 'available' %}selected{% endif %}>–° —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</option>
          <option value="not_available" {% if request.GET.certificate == 'not_available' %}selected{% endif %}>–ë–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</option>
        </select>
      </div>

      <div class="col-auto">
        <select class="form-select filter-select" data-param="sort">
          <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
          <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
          <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
          <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üë</option>
          <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üì</option>
        </select>
      </div>
    </div>
    
    <!-- üîπ –°–µ—Ç–∫–∞ –∫—É—Ä—Å–æ–≤ -->
    <div class="row g-4 courses-grid">
      {% for course in courses %}
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm position-relative">
          <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ -->
          <div class="ratio ratio-16x9">
            <img src="{{ course.image_url }}"
                 alt="{{ course.title }}"
                 class="card-img-top"
                 style="object-fit: cover;"
                 loading="lazy">
          </div>

          <div class="card-body d-flex flex-column">
            <span class="badge bg-primary mb-2">
              {{ course.course.category.name|default:"–ë–∏–∑–Ω–µ—Å" }}
            </span>
            <h5 class="card-title">{{ course.title }}</h5>
            <p class="card-text text-muted small flex-grow-1">
              {{ course.short_description|default:course.course.description|truncatewords:20 }}
            </p>

            <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
            <div class="d-flex justify-content-between align-items-center mt-2">
              <span class="text-warning small">
                <i class="bi bi-star-fill"></i> {{ course.average_rating|default:"4.8" }}
              </span>
              {% if course.price == 0 %}
                <span class="fw-bold text-success">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
              {% else %}
                <span class="fw-bold">{{ course.price }} ‚Ç∏</span>
              {% endif %}
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ -->
            {% if course.has_certificate %}
              <div class="mt-2">
                <small class="text-muted">
                  <i class="bi bi-award"></i> –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: {{ course.certificate_price|default:"12,000" }} ‚Ç∏
                </small>
              </div>
            {% endif %}
          </div>

          <div class="card-footer bg-white border-0">
            <a href="{% url 'course_detail' course.course.slug %}" class="btn btn-sm btn-outline-primary w-100">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          </div>

          {% if course.is_popular %}
            <span class="badge bg-danger position-absolute top-0 end-0 m-2">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π</span>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center py-5">
        <i class="bi bi-search" style="font-size: 3rem; color: var(--bs-gray-400);"></i>
        <h4 class="text-muted mt-3">–ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
        <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
        <a href="{% url 'courses_list' %}" class="btn btn-primary mt-3">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
      </div>
      {% endfor %}
    </div>

    <!-- üîπ –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
      <nav class="mt-4" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">–ù–∞–∑–∞–¥</a>
            </li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">–í–ø–µ—Ä–µ–¥</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ select —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  document.querySelectorAll('.filter-select').forEach(el => {
    el.addEventListener('change', () => {
      const url = new URL(window.location.href);
      const param = el.dataset.param;
      const value = el.value;
      
      if (value) {
        url.searchParams.set(param, value);
      } else {
        url.searchParams.delete(param);
      }
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
      url.searchParams.delete('page');
      
      window.location.href = url.toString();
    });
  });

  // –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const activeFilters = [];
    
    urlParams.forEach((value, key) => {
      if (key !== 'page' && value) {
        activeFilters.push(`${key}=${value}`);
      }
    });
    
    if (activeFilters.length > 0) {
      console.log('–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:', activeFilters.join('&'));
    }
  });
</script>
{% endblock %}