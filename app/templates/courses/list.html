{% extends 'base.html' %}
{% load static %}

{% block title %}–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–æ–≤ ‚Äî SkillsSpire{% endblock %}

{% block content %}

<section class="section" style="padding-top: 3rem; padding-bottom: 2rem;">
  <div class="container">
    <div class="section-header text-center">
      <h1 class="mb-2">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–æ–≤</h1>
      <p class="text-muted">–£—á–∏—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é –ø–ª–∞—Ç—É</p>
    </div>

    <!-- SEO-–±–ª–æ–∫ -->
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8 text-center">
        <p class="text-muted">
          –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ SkillsSpire –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã –ø–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º, –∞–Ω–∞–ª–∏—Ç–∏–∫–µ, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É –∏ —ç–∫–æ–Ω–æ–º–∏–∫–µ. 
          –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Ä–µ–∑—é–º–µ –∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∑–∞ —Ä—É–±–µ–∂.
        </p>
      </div>
    </div>

    <!-- üîπ –§–∏–ª—å—Ç—Ä—ã —Å–≤–µ—Ä—Ö—É (Skillbox-style) -->
    <div class="filters-bar d-flex flex-wrap gap-2 justify-content-center mb-4">
      <!-- –£—Ä–æ–≤–µ–Ω—å -->
      <div class="dropdown">
        <button class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown">–£—Ä–æ–≤–µ–Ω—å</button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item filter-link" data-param="level" data-value="beginner">–ù–∞—á–∏–Ω–∞—é—â–∏–π</a></li>
          <li><a class="dropdown-item filter-link" data-param="level" data-value="intermediate">–°—Ä–µ–¥–Ω–∏–π</a></li>
          <li><a class="dropdown-item filter-link" data-param="level" data-value="advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</a></li>
        </ul>
      </div>

      <!-- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç -->
      <div class="dropdown">
        <button class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item filter-link" data-param="certificate" data-value="">–í—Å–µ</a></li>
          <li><a class="dropdown-item filter-link" data-param="certificate" data-value="available">–° —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</a></li>
          <li><a class="dropdown-item filter-link" data-param="certificate" data-value="not_available">–ë–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</a></li>
        </ul>
      </div>

      <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
      <div>
        <select class="form-select filter-select" data-param="sort">
          <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
          <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
          <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
        </select>
      </div>
    </div>
    
    <!-- –°–µ—Ç–∫–∞ –∫—É—Ä—Å–æ–≤ -->
    <div class="courses-grid">
      {% for course in courses %}
        <a href="{% url 'course_detail' course.slug %}" class="course-card d-block text-decoration-none">
          <img src="{{ course.display_image_url }}" class="course-card-img" alt="{{ course.title }}" loading="lazy">

          <div class="course-card-content">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="course-category">{{ course.category.name|default:"–ë–∏–∑–Ω–µ—Å" }}</span>
              <div class="course-rating">
                <i class="bi bi-star-fill"></i> {{ course.average_rating|default:"4.8" }}
              </div>
            </div>

            <h3 class="course-card-title">{{ course.title }}</h3>
            <p class="course-card-text">{{ course.short_description|default:course.description|truncatewords:18 }}</p>

            <div class="course-card-meta">
              <div class="d-flex align-items-center gap-2 mb-2">
                <span class="text-success fw-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                {% if course.has_certificate %}
                  <span class="text-muted">üí≥ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: {{ course.certificate_price|default:"12,000" }} ‚Ç∏</span>
                {% endif %}
              </div>
            </div>
          </div>

          {% if course.is_popular %}
            <div class="badge">
              <span class="badge bg-danger">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π</span>
            </div>
          {% endif %}
        </a>
      {% empty %}
        <div class="text-center py-5">
          <i class="bi bi-search" style="font-size: 4rem; color: var(--color-text-tertiary);"></i>
          <h4 class="text-muted mt-3">–ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
          <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
        </div>
      {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
      <nav class="mt-4" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
        <ul class="pagination justify-content-center mb-0">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a>
            </li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            <li class="page-item {% if page_obj.number == num %}active{% endif %}">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}">–í–ø–µ—Ä–µ–¥</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ URL
  function updateCourses(params) {
    const url = new URL(window.location.href);
    Object.keys(params).forEach(key => {
      if (params[key]) {
        url.searchParams.set(key, params[key]);
      } else {
        url.searchParams.delete(key);
      }
    });

    fetch(url)
      .then(r => r.text())
      .then(html => {
        const newGrid = new DOMParser()
          .parseFromString(html, 'text/html')
          .querySelector('.courses-grid').innerHTML;
        document.querySelector('.courses-grid').innerHTML = newGrid;
        history.pushState({}, '', url); // –æ–±–Ω–æ–≤–ª—è–µ–º URL
      });
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è dropdown-—Ñ–∏–ª—å—Ç—Ä–æ–≤
  document.querySelectorAll('.filter-link').forEach(el => {
    el.addEventListener('click', e => {
      e.preventDefault();
      updateCourses({ [el.dataset.param]: el.dataset.value });
    });
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  document.querySelectorAll('.filter-select').forEach(el => {
    el.addEventListener('change', () => {
      updateCourses({ [el.dataset.param]: el.value });
    });
  });
</script>
{% endblock %}