{% extends 'base.html' %}
{% load static %}

{% block title %}–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–æ–≤ ‚Äî SkillsSpire{% endblock %}

{% block content %}
<section class="section courses-section py-5">
  <div class="container">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="section-header text-center mb-5">
      <h1 class="fw-bold mb-3">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–æ–≤</h1>
      <p class="lead text-secondary">
        –£—á–∏—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é –ø–ª–∞—Ç—É.
      </p>
      <p class="text-muted mt-2">
        –ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ <strong>SkillsSpire</strong> –¥–æ—Å—Ç—É–ø–Ω—ã –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã –ø–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º, –∞–Ω–∞–ª–∏—Ç–∏–∫–µ, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É –∏ —ç–∫–æ–Ω–æ–º–∏–∫–µ.<br>
        –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Ä–µ–∑—é–º–µ –∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∑–∞ —Ä—É–±–µ–∂.
      </p>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters-form shadow-sm mb-5">
      <select class="filter-select" data-param="level">
        <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
        <option value="beginner" {% if request.GET.level == 'beginner' %}selected{% endif %}>–ù–∞—á–∏–Ω–∞—é—â–∏–π</option>
        <option value="intermediate" {% if request.GET.level == 'intermediate' %}selected{% endif %}>–°—Ä–µ–¥–Ω–∏–π</option>
        <option value="advanced" {% if request.GET.level == 'advanced' %}selected{% endif %}>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
      </select>

      <select class="filter-select" data-param="certificate">
        <option value="">–í—Å–µ –∫—É—Ä—Å—ã</option>
        <option value="available" {% if request.GET.certificate == 'available' %}selected{% endif %}>–° —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</option>
        <option value="not_available" {% if request.GET.certificate == 'not_available' %}selected{% endif %}>–ë–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</option>
      </select>

      <select class="filter-select" data-param="sort">
        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
        <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
        <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
      </select>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫—É—Ä—Å–æ–≤ -->
    <div class="courses-grid">
      {% for course in courses %}
      <a href="{% url 'course_detail' course.course.slug %}" class="course-card-link">
        <article class="course-card">
          <img src="{{ course.image_url }}" alt="{{ course.title }}" class="course-card-img" loading="lazy">

          <div class="course-card-content">
            <div class="d-flex justify-content-between align-items-center mb-2">
              {% if course.type == 'profession' %}
                <span class="badge bg-primary">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è</span>
              {% else %}
                <span class="badge bg-secondary">–ö—É—Ä—Å</span>
              {% endif %}

              {% if course.is_popular %}
                <span class="badge bg-danger">–•–∏—Ç –ø—Ä–æ–¥–∞–∂</span>
              {% endif %}
            </div>

            <h3 class="course-card-title">{{ course.title }}</h3>
            <p class="course-card-text">
              {{ course.short_description|default:course.course.description|truncatewords:22 }}
            </p>

            <!-- –Ω–∏–∂–Ω–∏–π –±–ª–æ–∫ -->
            <div class="course-card-meta mt-auto small text-muted">
              {% if course.duration_hours %}
                ‚è± {{ course.duration_hours }} —á{% if course.has_certificate %} ‚Ä¢ {% endif %}
              {% endif %}
              {% if course.has_certificate %}
                üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
              {% endif %}
            </div>
          </div>
        </article>
      </a>

      {% empty %}
      <div class="col-12 text-center py-5">
        <i class="bi bi-search" style="font-size:3rem;color:#cbd5e0;"></i>
        <h4 class="text-muted mt-3">–ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
        <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
        <a href="{% url 'courses_list' %}" class="btn btn-primary mt-3">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
      </div>
      {% endfor %}
    </div>

    <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø -->
    {% if is_paginated %}
    <nav class="mt-5 pagination-modern" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
      <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link"
             href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
            –ù–∞–∑–∞–¥
          </a>
        </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
        <li class="page-item {% if num == page_obj.number %}active{% endif %}">
          <a class="page-link"
             href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
            {{ num }}
          </a>
        </li>
        {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link"
             href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
            –í–ø–µ—Ä–µ–¥
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.courses-section {
  background: linear-gradient(180deg, #f8faff 0%, #ffffff 100%);
}
.filters-form {
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
  background: #fff;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  border: 1px solid var(--color-border);
}
.filters-form select {
  padding: 0.6rem 1rem;
  border-radius: 8px;
  border: 1px solid var(--color-border);
  background: var(--color-bg-white);
  font-size: 1rem;
}
.courses-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1.8rem;
}
.course-card-link {
  text-decoration: none;
  color: inherit;
  display: block;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}
.course-card {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: all 0.25s ease;
}
.course-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 24px rgba(0,0,0,0.12);
}
.course-card-img {
  width: 100%;
  height: 200px;
  object-fit: cover;
}
.course-card-content {
  padding: 1.25rem 1.25rem 1.5rem;
  display: flex;
  flex-direction: column;
  flex: 1;
}
.course-card-title {
  font-size: 1.125rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}
.course-card-text {
  font-size: 0.95rem;
  color: var(--color-text-secondary);
  flex: 1;
}
.course-card-meta {
  font-size: 0.9rem;
  color: var(--color-text-secondary);
  margin-top: 0.75rem;
}
.pagination-modern .page-link {
  border-radius: 8px;
  margin: 0 4px;
  padding: 0.6rem 1rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.filter-select').forEach(el => {
  el.addEventListener('change', () => {
    const url = new URL(window.location.href);
    const param = el.dataset.param;
    const value = el.value;

    if (value) url.searchParams.set(param, value);
    else url.searchParams.delete(param);

    url.searchParams.delete('page');
    window.location.href = url.toString();
  });
});
</script>
{% endblock %}
