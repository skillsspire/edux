{% extends "base.html" %}
{% load static humanize %}

{% block title %}{{ course.title }} ‚Äî SkillsSpire{% endblock %}

{% block content %}

<section class="course-hero modern-hero">
  <div class="container hero-inner">
    <div class="hero-left">
      <span class="course-badge">{{ course.category.name }}</span>
      <h1>{{ course.title }}</h1>
      <p>{{ course.short_description }}</p>

      <ul class="hero-features">
        <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</li>
        <li>‚ôæÔ∏è –ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø</li>
        <li>üì± –£–¥–æ–±–Ω–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</li>
        <li>üíæ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</li>
      </ul>

      <div class="hero-actions">
        {% if has_access %}
          <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="btn btn-primary btn-lg">
            –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
          </a>
        {% else %}
          <form action="{% url 'enroll_course' course.slug %}" method="post">
            {% csrf_token %}
            <button class="btn btn-primary btn-lg">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
          </form>
        {% endif %}

        <a href="#program" class="btn btn-outline btn-lg">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</a>
      </div>
    </div>

    <div class="hero-right">
      <div class="course-price-card">
        <p class="new-price">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</p>

        {% if has_access %}
          <a href="{% url 'lesson_detail' course.slug first_lesson.slug %}" class="btn btn-primary btn-full">
            –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—É—á–µ–Ω–∏—é
          </a>
        {% else %}
          <form action="{% url 'enroll_course' course.slug %}" method="post">
            {% csrf_token %}
            <button class="btn btn-primary btn-full">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
          </form>
        {% endif %}

        <a href="{% url 'toggle_wishlist' course.slug %}" class="btn btn-outline btn-full mt-2">
          {% if is_in_wishlist %}
            <i class="bi bi-heart-fill"></i> –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
          {% else %}
            <i class="bi bi-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
          {% endif %}
        </a>
      </div>
    </div>
  </div>
</section>


<section class="section course-about">
  <div class="container about-grid">
    <div class="about-text">
      <h2>–û –∫—É—Ä—Å–µ</h2>
      <p>{{ course.description|safe|default:"–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è." }}</p>
      <ul>
        <li>üìò {{ lessons|length }} —É—Ä–æ–∫–æ–≤</li>
        <li>‚ôæÔ∏è –î–æ—Å—Ç—É–ø –Ω–∞–≤—Å–µ–≥–¥–∞</li>
        <li>üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏</li>
      </ul>
    </div>
    <div class="about-img">
      <img src="{{ course.display_image_url|default:static('img/default.jpg') }}" alt="{{ course.title }}">
    </div>
  </div>
</section>


<section id="program" class="section program-section">
  <div class="container">
    <h2 class="text-center mb-3">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞</h2>

    {% if lessons %}
      <div class="lessons-list">
        {% for lesson in lessons %}
          <div class="lesson-item">
            <div class="lesson-info">
              <h3>{{ lesson.title }}</h3>
              {% if lesson.duration_minutes %}
                <span class="lesson-duration">{{ lesson.duration_minutes }} –º–∏–Ω</span>
              {% endif %}
            </div>

            <a href="{% url 'lesson_detail' course.slug lesson.slug %}" class="btn btn-outline">
              ‚ñ∂ –°–º–æ—Ç—Ä–µ—Ç—å
            </a>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center text-muted">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ.</p>
    {% endif %}
  </div>
</section>


<section class="section instructor-section">
  <div class="container text-center">
    <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</h2>

    {% if teacher_profile %}
      <div class="instructor-card">
        <img src="{{ teacher_profile.display_avatar_url|default:static('img/avatar-placeholder.svg') }}" alt="–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä">
        <h3>{{ teacher_profile.user.get_full_name }}</h3>
        <p class="text-secondary">{{ teacher_profile.specialization|default:"–≠–∫—Å–ø–µ—Ä—Ç" }}</p>
        <p>{{ teacher_profile.bio|truncatewords:35 }}</p>
      </div>
    {% else %}
      <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–∑–∂–µ.</p>
    {% endif %}
  </div>
</section>


<section class="testimonials-section">
  <div class="container">
    <h2 class="text-center mb-3">–û—Ç–∑—ã–≤—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>

    {% if reviews %}
      <div class="testimonials-grid">
        {% for review in reviews %}
          <div class="testimonial-card">
            <p>‚Äú{{ review.comment|truncatewords:35 }}‚Äù</p>
            <p class="text-sm text-secondary">
              ‚Äî {{ review.name|default:"–ê–Ω–æ–Ω–∏–º" }}, {{ review.created_at|date:"d M Y" }}
            </p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center text-muted">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
  </div>
</section>

{% endblock %}
