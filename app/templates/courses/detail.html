{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        {% if course.image %}
        <img src="{{ course.image.url }}" class="img-fluid mb-3" alt="{{ course.title }}">
        {% endif %}
        <h1>{{ course.title }}</h1>
        <p class="text-muted">Instructor: {{ course.instructor.get_full_name }}</p>
        <p>Category: {{ course.category.name }}</p>
        <p>Duration: {{ course.duration }} hours</p>
        <p>Price: ${{ course.price }}</p>
        
        <h3>Description</h3>
        <p>{{ course.description }}</p>
        
        <h3>Lessons</h3>
        <div class="list-group">
            {% for lesson in course.lesson_set.all %}
            <div class="list-group-item">
                <h5>Lesson {{ lesson.order }}: {{ lesson.title }}</h5>
                <p>{{ lesson.content|truncatewords:30 }}</p>
            </div>
            {% empty %}
            <p>No lessons available yet.</p>
            {% endfor %}
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Enroll Now</h5>
                <p class="card-text">${{ course.price }}</p>
                {% if user.is_authenticated %}
                    {% if is_enrolled %}
                        <button class="btn btn-success" disabled>Already Enrolled</button>
                        <a href="{% url 'my_courses' %}" class="btn btn-primary mt-2">Go to My Courses</a>
                    {% else %}
                        <form method="post" action="{% url 'enroll_course' course.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary">Enroll Now</button>
                        </form>
                    {% endif %}
                {% else %}
                    <p>Please <a href="{% url 'admin:login' %}">login</a> to enroll in this course.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}