{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Login" %} ‚Äî SkillsSpire{% endblock %}

{% block extra_css %}
<style>
.login-section {
  padding: 4rem 0;
  min-height: calc(100vh - 180px);
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, var(--color-bg-section) 0%, var(--color-bg-white) 100%);
  position: relative;
  overflow: hidden;
}

.login-section::before {
  content: '';
  position: absolute;
  top: -100px;
  right: -100px;
  width: 300px;
  height: 300px;
  background: linear-gradient(135deg, rgba(1, 52, 157, 0.05) 0%, rgba(59, 92, 197, 0.05) 100%);
  border-radius: 50%;
}

.login-section::after {
  content: '';
  position: absolute;
  bottom: -80px;
  left: -80px;
  width: 200px;
  height: 200px;
  background: linear-gradient(135deg, rgba(255, 77, 140, 0.05) 0%, rgba(255, 111, 163, 0.05) 100%);
  border-radius: 50%;
}

.login-container {
  max-width: 480px;
  margin: 0 auto;
  width: 100%;
  position: relative;
  z-index: 1;
}

.login-card {
  background: var(--color-bg-white);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
  border: 1px solid var(--color-border);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.login-card:hover {
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
}

.login-header {
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
  color: white;
  padding: 2.5rem 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.login-header::before {
  content: 'üëã';
  position: absolute;
  top: 50%;
  right: 40px;
  transform: translateY(-50%);
  font-size: 3rem;
  opacity: 0.15;
}

.login-header h1 {
  font-size: clamp(1.8rem, 3vw, 2.2rem);
  font-weight: 800;
  margin-bottom: 0.5rem;
  position: relative;
  z-index: 1;
}

.login-subtitle {
  font-size: 1rem;
  opacity: 0.9;
  position: relative;
  z-index: 1;
}

.login-body {
  padding: 2.5rem 2rem;
}

.login-form .form-group {
  margin-bottom: 1.5rem;
}

.login-form label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: 0.95rem;
}

.login-form .form-control {
  width: 100%;
  padding: 1rem 1.25rem;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: 1rem;
  background: var(--color-bg-section);
  color: var(--color-text-primary);
  transition: all 0.3s ease;
}

.login-form .form-control:focus {
  outline: none;
  border-color: var(--color-primary);
  background: var(--color-bg-white);
  box-shadow: 0 0 0 4px rgba(1, 52, 157, 0.15);
}

.login-form .form-control::placeholder {
  color: var(--color-text-tertiary);
}

.password-container {
  position: relative;
}

.toggle-password {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--color-text-tertiary);
  cursor: pointer;
  padding: 0.25rem;
  font-size: 1.2rem;
  transition: color 0.3s ease;
}

.toggle-password:hover {
  color: var(--color-primary);
}

.form-options {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 1.5rem 0;
  flex-wrap: wrap;
  gap: 1rem;
}

.remember-me {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.remember-me input[type="checkbox"] {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  border: 2px solid var(--color-border);
  cursor: pointer;
  accent-color: var(--color-primary);
}

.forgot-password {
  color: var(--color-primary);
  font-weight: 600;
  text-decoration: none;
  transition: color 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.forgot-password:hover {
  color: var(--color-primary-dark);
  text-decoration: underline;
}

.submit-btn {
  width: 100%;
  padding: 1.1rem;
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
  color: white;
  border: none;
  border-radius: var(--radius-md);
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(1, 52, 157, 0.25);
}

.submit-btn:active {
  transform: translateY(0);
}

.submit-btn.is-loading {
  background: var(--color-primary-dark);
  cursor: not-allowed;
}

.submit-btn.is-loading span {
  display: none;
}

.submit-btn.is-loading::after {
  content: '';
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.login-footer {
  text-align: center;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border);
}

.register-link {
  color: var(--color-primary);
  font-weight: 600;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: color 0.3s ease;
}

.register-link:hover {
  color: var(--color-primary-dark);
  text-decoration: underline;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö */
.alert-error {
  background: var(--color-error-bg);
  color: var(--color-error-text);
  border: 1px solid var(--color-error);
  border-radius: var(--radius-md);
  padding: 1rem 1.25rem;
  margin-bottom: 1.5rem;
  animation: slideInDown 0.3s ease;
}

.alert-error ul {
  margin: 0.5rem 0 0 0;
  padding-left: 1.5rem;
}

.alert-error li {
  margin-bottom: 0.25rem;
}

@keyframes slideInDown {
  from {
    transform: translateY(-10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
.alert-success {
  background: var(--color-success-bg);
  color: var(--color-success-text);
  border: 1px solid var(--color-success);
  border-radius: var(--radius-md);
  padding: 1rem 1.25rem;
  margin-bottom: 1.5rem;
  animation: slideInDown 0.3s ease;
}

.alert-success .alert-content {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .login-section {
    padding: 2rem 1rem;
  }
  
  .login-header {
    padding: 2rem 1.5rem;
  }
  
  .login-header::before {
    font-size: 2rem;
    right: 20px;
  }
  
  .login-body {
    padding: 2rem 1.5rem;
  }
  
  .form-options {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
}

@media (max-width: 480px) {
  .login-header h1 {
    font-size: 1.6rem;
  }
  
  .login-form .form-control {
    padding: 0.9rem 1rem;
  }
  
  .submit-btn {
    padding: 1rem;
    font-size: 1rem;
  }
}
</style>
{% endblock %}

{% block content %}
<section class="login-section">
  <div class="container login-container">
    <div class="login-card">
      <div class="login-header">
        <h1>–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!</h1>
        <p class="login-subtitle">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</p>
      </div>
      
      <div class="login-body">
        {% if form.errors %}
        <div class="alert-error">
          <strong>–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ:</strong>
          <ul>
            {% for field, errors in form.errors.items %}
              {% for error in errors %}
                <li>{{ error }}</li>
              {% endfor %}
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if messages %}
          {% for message in messages %}
            {% if message.tags == 'success' %}
              <div class="alert-success">
                <div class="alert-content">
                  <i>‚úÖ</i>
                  <div>{{ message }}</div>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endif %}

        <form method="post" novalidate class="login-form" id="login-form">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.GET.next }}">

          <div class="form-group">
            <label for="username">Email –∏–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" name="username" id="username" class="form-control"
                   required autocomplete="email"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                   value="{{ form.username.value|default:'' }}">
            <div class="form-text" style="font-size: 0.85rem; color: var(--color-text-tertiary); margin-top: 0.25rem;">
              –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email –∏–ª–∏ –ª–æ–≥–∏–Ω, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            </div>
          </div>

          <div class="form-group">
            <label for="password">–ü–∞—Ä–æ–ª—å</label>
            <div class="password-container">
              <input type="password" name="password" id="password" class="form-control"
                     required autocomplete="current-password"
                     placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
              <button type="button" class="toggle-password" id="toggle-password">
                üëÅÔ∏è
              </button>
            </div>
          </div>

          <div class="form-options">
            <label class="remember-me">
              <input type="checkbox" name="remember" value="1">
              <span>–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</span>
            </label>
            <a href="{% url 'password_reset' %}" class="forgot-password">
              <i>üîë</i>
              <span>–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</span>
            </a>
          </div>

          <button type="submit" class="submit-btn" id="submit-btn">
            <i>üöÄ</i>
            <span>–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</span>
          </button>
        </form>

        <div class="login-footer">
          <p>
            –ï—â—ë –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?
            <a href="{% url 'signup' %}" class="register-link">
              –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç <i>‚Üí</i>
            </a>
          </p>
          
          <p style="font-size: 0.85rem; color: var(--color-text-tertiary); margin-top: 1rem;">
            –ü—Ä–æ–¥–æ–ª–∂–∞—è, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å 
            <a href="/terms/" style="color: var(--color-primary); text-decoration: none;">–£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('login-form');
  const submitBtn = document.getElementById('submit-btn');
  const togglePasswordBtn = document.getElementById('toggle-password');
  const passwordInput = document.getElementById('password');
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
  togglePasswordBtn.addEventListener('click', function() {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    togglePasswordBtn.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
  });
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  form.addEventListener('submit', function(e) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª–µ–π
    const username = document.getElementById('username').value.trim();
    const password = passwordInput.value.trim();
    
    if (!username || !password) {
      e.preventDefault();
      showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
      return false;
    }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    submitBtn.classList.add('is-loading');
    submitBtn.disabled = true;
    
    return true;
  });
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –µ—Å—Ç—å –≤ URL
  const urlParams = new URLSearchParams(window.location.search);
  const nextParam = urlParams.get('next');
  if (nextParam && nextParam.includes('signup')) {
    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    showToast('–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.', 'success');
  }
  
  // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
  const loginCard = document.querySelector('.login-card');
  setTimeout(() => {
    loginCard.style.opacity = '1';
    loginCard.style.transform = 'translateY(0)';
  }, 100);
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
  loginCard.style.opacity = '0';
  loginCard.style.transform = 'translateY(20px)';
  loginCard.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
  
  // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ username
  const usernameField = document.getElementById('username');
  if (usernameField) {
    setTimeout(() => usernameField.focus(), 300);
  }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    background: ${type === 'error' ? 'var(--color-error)' : type === 'success' ? 'var(--color-success)' : 'var(--color-primary)'};
    color: white;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    z-index: 10000;
    animation: slideIn 0.3s ease;
  `;
  
  document.body.appendChild(toast);
  
  // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    toast.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => {
      document.body.removeChild(toast);
    }, 300);
  }, 4000);
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
const toastStyles = document.createElement('style');
toastStyles.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
`;
document.head.appendChild(toastStyles);
</script>
{% endblock %}