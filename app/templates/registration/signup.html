{% extends "base.html" %}
{% load i18n widget_tweaks %}

{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî SkillsSpire{% endblock %}

{% block extra_css %}
<style>
.signup-section {
  padding: 4rem 0;
  min-height: calc(100vh - 180px);
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, var(--color-bg-section) 0%, var(--color-bg-white) 100%);
}

.signup-container {
  max-width: 500px;
  margin: 0 auto;
  width: 100%;
}

.signup-card {
  background: var(--color-bg-white);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
  border: 1px solid var(--color-border);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.signup-card:hover {
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
}

.signup-header {
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
  color: white;
  padding: 2.5rem 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.signup-header::before {
  content: '';
  position: absolute;
  top: -50px;
  right: -50px;
  width: 150px;
  height: 150px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
}

.signup-header::after {
  content: '';
  position: absolute;
  bottom: -30px;
  left: -30px;
  width: 100px;
  height: 100px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 50%;
}

.signup-header h1 {
  font-size: clamp(1.8rem, 3vw, 2.2rem);
  font-weight: 800;
  margin-bottom: 0.5rem;
  position: relative;
  z-index: 1;
}

.signup-subtitle {
  font-size: 1rem;
  opacity: 0.9;
  position: relative;
  z-index: 1;
}

.signup-body {
  padding: 2.5rem 2rem;
}

.signup-form .form-group {
  margin-bottom: 1.5rem;
}

.signup-form label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: 0.95rem;
}

.signup-form .form-control {
  width: 100%;
  padding: 1rem 1.25rem;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: 1rem;
  background: var(--color-bg-section);
  color: var(--color-text-primary);
  transition: all 0.3s ease;
}

.signup-form .form-control:focus {
  outline: none;
  border-color: var(--color-primary);
  background: var(--color-bg-white);
  box-shadow: 0 0 0 4px rgba(1, 52, 157, 0.15);
}

.signup-form .form-control::placeholder {
  color: var(--color-text-tertiary);
}

.password-hint {
  font-size: 0.85rem;
  color: var(--color-text-tertiary);
  margin-top: 0.5rem;
  line-height: 1.4;
}

.form-errors {
  font-size: 0.9rem;
  margin-top: 0.25rem;
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.form-errors i {
  color: var(--color-error);
  font-size: 1rem;
  flex-shrink: 0;
}

.captcha-container {
  background: var(--color-bg-section);
  border-radius: var(--radius-md);
  padding: 1.5rem;
  margin: 1.5rem 0;
  text-align: center;
  border: 2px solid var(--color-border);
}

.captcha-container label {
  display: block;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: var(--color-text-primary);
}

.captcha-container .grecaptcha-badge {
  margin: 0 auto;
  display: inline-block;
}

.captcha-note {
  font-size: 0.85rem;
  color: var(--color-text-tertiary);
  margin-top: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.captcha-note i {
  color: var(--color-primary);
}

.submit-btn {
  width: 100%;
  padding: 1.1rem;
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
  color: white;
  border: none;
  border-radius: var(--radius-md);
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-top: 1rem;
}

.submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(1, 52, 157, 0.25);
}

.submit-btn:active {
  transform: translateY(0);
}

.submit-btn.is-loading {
  background: var(--color-primary-dark);
  cursor: not-allowed;
}

.submit-btn.is-loading span {
  display: none;
}

.submit-btn.is-loading::after {
  content: '';
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.signup-footer {
  text-align: center;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border);
}

.login-link {
  color: var(--color-primary);
  font-weight: 600;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  transition: color 0.3s ease;
}

.login-link:hover {
  color: var(--color-primary-dark);
  text-decoration: underline;
}

.terms {
  font-size: 0.85rem;
  color: var(--color-text-tertiary);
  margin-top: 1.5rem;
  line-height: 1.5;
}

.terms a {
  color: var(--color-primary);
  text-decoration: none;
  font-weight: 500;
}

.terms a:hover {
  text-decoration: underline;
}

.signup-features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
  padding: 1.5rem;
  background: var(--color-bg-section);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.feature-icon {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: rgba(1, 52, 157, 0.1);
  color: var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  flex-shrink: 0;
}

.feature-text {
  font-size: 0.9rem;
  color: var(--color-text-secondary);
}

.feature-text strong {
  color: var(--color-text-primary);
  display: block;
  margin-bottom: 0.25rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .signup-section {
    padding: 2rem 1rem;
  }
  
  .signup-header {
    padding: 2rem 1.5rem;
  }
  
  .signup-body {
    padding: 2rem 1.5rem;
  }
  
  .signup-features {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .signup-header h1 {
    font-size: 1.6rem;
  }
  
  .signup-form .form-control {
    padding: 0.9rem 1rem;
  }
  
  .submit-btn {
    padding: 1rem;
    font-size: 1rem;
  }
}
</style>
{% endblock %}

{% block content %}
<section class="signup-section">
  <div class="container signup-container">
    <div class="signup-card">
      <div class="signup-header">
        <h1>–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç</h1>
        <p class="signup-subtitle">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É SkillsSpire</p>
      </div>
      
      <div class="signup-body">
        {% if form.non_field_errors %}
        <div class="alert alert-error" style="margin-bottom: 1.5rem;">
          <div class="alert-content">
            <i>‚ö†Ô∏è</i>
            <div>
              {% for error in form.non_field_errors %}
                <p style="margin: 0;">{{ error }}</p>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endif %}

        <form method="post" novalidate class="signup-form" id="signup-form">
          {% csrf_token %}

          <div class="form-group">
            <label for="{{ form.username.id_for_label }}">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            {{ form.username|add_class:"form-control"|attr:"placeholder:–ù–∞–ø—Ä–∏–º–µ—Ä, alex_ivanov" }}
            {% if form.username.errors %}
              <div class="form-errors">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.username.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.email.id_for_label }}">Email</label>
            {{ form.email|add_class:"form-control"|attr:"placeholder:you@example.com" }}
            {% if form.email.errors %}
              <div class="form-errors">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.email.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.first_name.id_for_label }}">–ò–º—è</label>
            {{ form.first_name|add_class:"form-control"|attr:"placeholder:–ò–≤–∞–Ω" }}
            {% if form.first_name.errors %}
              <div class="form-errors">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.first_name.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.last_name.id_for_label }}">–§–∞–º–∏–ª–∏—è</label>
            {{ form.last_name|add_class:"form-control"|attr:"placeholder:–ò–≤–∞–Ω–æ–≤" }}
            {% if form.last_name.errors %}
              <div class="form-errors">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.last_name.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.password1.id_for_label }}">–ü–∞—Ä–æ–ª—å</label>
            {{ form.password1|add_class:"form-control"|attr:"placeholder:–ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤" }}
            <div class="password-hint">
              –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –≤–∫–ª—é—á–∞—è –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã.
            </div>
            {% if form.password1.errors %}
              <div class="form-errors">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.password1.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.password2.id_for_label }}">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
            {{ form.password2|add_class:"form-control"|attr:"placeholder:–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" }}
            {% if form.password2.errors %}
              <div class="form-errors">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.password2.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
          </div>

          <div class="captcha-container">
            <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã –Ω–µ —Ä–æ–±–æ—Ç</label>
            {{ form.captcha }}
            {% if form.captcha.errors %}
              <div class="form-errors" style="margin-top: 1rem;">
                <i>‚ö†Ô∏è</i>
                <div>{% for error in form.captcha.errors %}{{ error }} {% endfor %}</div>
              </div>
            {% endif %}
            <div class="captcha-note">
              <i>üîí</i>
              <span>–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π</span>
            </div>
          </div>

          <button type="submit" class="submit-btn" id="submit-btn">
            <i>üöÄ</i>
            <span>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
          </button>
        </form>

        <div class="signup-features">
          <div class="feature-item">
            <div class="feature-icon">üéì</div>
            <div class="feature-text">
              <strong>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</strong>
              <span>–ö –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –∫—É—Ä—Å–∞–º —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</span>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üìö</div>
            <div class="feature-text">
              <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</strong>
              <span>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ</span>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üë•</div>
            <div class="feature-text">
              <strong>–°–æ–æ–±—â–µ—Å—Ç–≤–æ</strong>
              <span>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—è–º –∏ –ø—Ä–æ–µ–∫—Ç–∞–º</span>
            </div>
          </div>
        </div>

        <div class="signup-footer">
          <p>
            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
            <a href="{% url 'login' %}" class="login-link">
              –í–æ–π—Ç–∏ <i>‚Üí</i>
            </a>
          </p>
          
          <div class="terms">
            –ù–∞–∂–∏–º–∞—è ¬´–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å 
            <a href="/terms/">–£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a> –∏ 
            <a href="/privacy/">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('signup-form');
  const submitBtn = document.getElementById('submit-btn');
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  form.addEventListener('submit', function(e) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ø—á–∏
    const captchaResponse = document.querySelector('[name="g-recaptcha-response"]');
    if (captchaResponse && !captchaResponse.value) {
      e.preventDefault();
      showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', 'error');
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞–ø—á–∏
      const captchaContainer = document.querySelector('.captcha-container');
      captchaContainer.style.animation = 'none';
      setTimeout(() => {
        captchaContainer.style.animation = 'shake 0.5s ease';
      }, 10);
      
      return false;
    }
    
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏
    submitBtn.classList.add('is-loading');
    submitBtn.disabled = true;
    
    return true;
  });
  
  // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
  const signupCard = document.querySelector('.signup-card');
  setTimeout(() => {
    signupCard.style.opacity = '1';
    signupCard.style.transform = 'translateY(0)';
  }, 100);
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
  signupCard.style.opacity = '0';
  signupCard.style.transform = 'translateY(20px)';
  signupCard.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –æ—à–∏–±–æ–∫ –∫–∞–ø—á–∏
  const style = document.createElement('style');
  style.textContent = `
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
  `;
  document.head.appendChild(style);
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showToast(message, type = 'info') {
  // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    background: ${type === 'error' ? 'var(--color-error)' : 'var(--color-primary)'};
    color: white;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    z-index: 10000;
    animation: slideIn 0.3s ease;
  `;
  
  document.body.appendChild(toast);
  
  // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    toast.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => {
      document.body.removeChild(toast);
    }, 300);
  }, 4000);
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
const toastStyles = document.createElement('style');
toastStyles.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
`;
document.head.appendChild(toastStyles);
</script>
{% endblock %}